#!/bin/bash
set -Eeuo pipefail
_ARGS="$@"

if [ "${DEBUG:-}" = "true" ]; then
    set -x
fi

source _assert
source _identify
source _initialize

exec /srv/concurrently -P \
    --names kubelet,dockerd,controller,scheduler \
    --restart-tries -1 \
    --restart-after exponential \
    --kill-signal SIGINT \
    --teardown stop \
    "kubelet {*}" \
    "dockerd" \
    "controller" \
    "scheduler" \
    $_ARGS
